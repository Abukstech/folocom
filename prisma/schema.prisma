// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(auto()) @map("_id") @db.ObjectId
  email             String             @unique
  password          String
  name              String?
  role              Role               @default(BUYER)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  orders            Order[]
  assistedSourcings AssistedSourcing[]
  parts             Part[]
}

model Category {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  parts     Part[]
}

model Part {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  price       Float
  stock       Int     @default(0)
  imageUrl    String? // Add this if not present

  // Vehicle compatibility
  carMake   String
  carModel  String
  carYear   Int
  condition PartCondition

  categoryId String   @db.ObjectId
  category   Category @relation(fields: [categoryId], references: [id])

  sellerId String @db.ObjectId
  seller   User   @relation(fields: [sellerId], references: [id])

  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  orderItems OrderItem[]
}

model Order {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  userId      String      @db.ObjectId
  user        User        @relation(fields: [userId], references: [id])
  status      OrderStatus @default(PENDING)
  totalAmount Float
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  orderItems  OrderItem[]
}

model OrderItem {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId   String   @db.ObjectId
  order     Order    @relation(fields: [orderId], references: [id])
  partId    String   @db.ObjectId
  part      Part     @relation(fields: [partId], references: [id])
  quantity  Int
  price     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AssistedSourcing {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  // Car details
  carMake  String
  carModel String
  carYear  Int

  // Part request details
  condition       PartCondition // Brand New, Refurbished, Tokunbo
  partDescription String // Description of required part
  imageUrl        String? // Optional image URL

  // Request status
  status SourcingStatus @default(PENDING)

  // Admin response (optional, for when admin finds the part)
  adminNotes        String?
  quotedPrice       Float?
  estimatedDelivery DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  BUYER
  SELLER
  MECHANIC
  ADMIN
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PartCondition {
  BRAND_NEW
  REFURBISHED
  TOKUNBO
}

enum SourcingStatus {
  PENDING // Initial submission
  REVIEWING // Admin is reviewing
  QUOTED // Admin has provided a quote
  ACCEPTED // User accepted the quote
  SOURCING // Admin is sourcing the part
  READY // Part is ready for pickup/delivery
  COMPLETED // Request fulfilled
  CANCELLED // Request cancelled
}
